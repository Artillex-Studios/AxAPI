plugins {
    id 'java'
    id 'maven-publish'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.artillexstudios.axapi'
version = '1.4.22'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(8)
    }
}

dependencies {
    implementation project(path: ":api")
    implementation project(path: ":folia")
    implementation project(path: ":nms:v1_20_R3", configuration: "reobf")
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'java-library'
    apply plugin: 'maven-publish'
    apply plugin: 'com.github.johnrengelman.shadow'

    tasks {
        compileJava {
            options.compilerArgs += ["-parameters"]
            options.fork = true
            options.encoding = 'UTF-8'
        }
    }

    compileJava {
        options.compilerArgs += ["-parameters"]
        options.fork = true
        dependsOn(clean)
        options.encoding = "UTF-8"
    }

    repositories {
        mavenCentral()

        maven {
            name = 'PaperMC'
            url = 'https://repo.papermc.io/repository/maven-public/'
        }

        maven {
            name = 'JitPack'
            url = 'https://jitpack.io/'
        }

        maven {
            name = 'Libby'
            url = 'https://repo.alessiodp.com/releases/'
        }
    }

    dependencies {
        implementation("com.github.NEZNAMY:YamlAssist:1.0.5") {
            exclude group: 'org.yaml', module: 'snakeyaml'
        }

        implementation("dev.dejvokep:boosted-yaml:1.3") {
            exclude group: 'org.yaml', module: 'snakeyaml'
        }

        implementation("net.byteflux:libby-bukkit:1.3.0")
        implementation("net.kyori:adventure-platform-bukkit:4.3.0")
        implementation("net.kyori:adventure-text-minimessage:4.14.0")
        implementation("net.kyori:adventure-text-serializer-plain:4.14.0")
        compileOnly("it.unimi.dsi:fastutil-core:8.5.12")
        compileOnly("org.apache.commons:commons-math3:3.6.1")

        implementation("com.github.Revxrsal.Lamp:common:3.1.9") {
            exclude group: 'net.kyori', module: 'adventure'
        }
        implementation("com.github.Revxrsal.Lamp:bukkit:3.1.9") {
            exclude group: 'net.kyori', module: 'adventure'
        }
    }

    shadowJar {
        relocate('me.neznamy.yamlassist', 'com.artillexstudios.axapi.libs.yamlassist')
        relocate('dev.dejvokep', 'com.artillexstudios.axapi.libs.boostedyaml')
        relocate('net.byteflux.libby', 'com.artillexstudios.axapi.libs.libby')
    }

    publishing {
        publications {
            shadow(MavenPublication) { publication ->
                project.shadow.component(publication)
                groupId 'com.artillexstudios.axapi'
                artifactId 'axapi'
                version '1.4.22'
            }
        }
        repositories {
            mavenLocal()
        }
    }

    publishToMavenLocal {
        dependsOn {
            build
            shadowJar
        }
    }
}

allprojects.forEach { it.afterEvaluate {
println(it.name + " " + it.group + " " + it.version)
}  }